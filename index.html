<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Ravenclaw Entry</title>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="format-detection" content="telephone=no" />

    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <main class="wrap">
      <section class="card" role="region" aria-label="Ravenclaw Riddle Gate">
        <header class="header">
            <div class="header-text">
              <h1>Ravenclaw</h1>
              <p class="subtitle">
                If it is entry that you seek,<br />
                then answer true — let wit, not might, speak.
              </p>
            </div>
          
            <div class="crest" aria-hidden="true">
              <img src="s-l1200.png" alt="" />
            </div>
          </header>

        <div class="divider"></div>

        <article class="riddle">
          <p>
            <span class="dropcap">I</span> exist only after passing,<br />
            and vanish where I am made.<br />
            I speak in pairs and silence,<br />
            proof without witness laid.<br />
            I am never ahead of you,<br />
            yet follow where you go.<br />
            Name me.
          </p>
        </article>

        <form id="riddleForm" class="form" autocomplete="off">
          <label for="answer" class="label">Your answer</label>

          <div class="inputRow">
            <input
              id="answer"
              name="answer"
              type="text"
              placeholder="Type your answer…"
              inputmode="text"
              autocapitalize="off"
              autocomplete="off"
              autocorrect="off"
              autofocus
              required
            />
            <button type="submit" class="btn">Enter</button>
          </div>

          <p id="feedback" class="feedback" aria-live="polite"></p>
        </form>

        <footer class="footer">
          <p class="small">Knowledge is the only key.</p>
        </footer>
      </section>
    </main>

    <script>
      const CORRECT_HASH =
        "1a11a5a27be607e96d0205aa1304d7f39c97416ab35892049129d3f6eafa90fb";

      function normalize(str) {
        return str
          .toLowerCase()
          .trim()
          .replace(/[^\p{L}\p{N}]/gu, "");
      }

      async function sha256(text) {
        const encoder = new TextEncoder();
        const data = encoder.encode(text);
        const hashBuffer = await crypto.subtle.digest("SHA-256", data);
        return Array.from(new Uint8Array(hashBuffer))
          .map(b => b.toString(16).padStart(2, "0"))
          .join("");
      }

      const form = document.getElementById("riddleForm");
      const input = document.getElementById("answer");
      const feedback = document.getElementById("feedback");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const guess = normalize(input.value);
        const guessHash = await sha256(guess);

        if (guessHash === CORRECT_HASH) {
          feedback.textContent =
            "Correct. The door yields. Proceed. ✨";
          feedback.className = "feedback ok";
          input.disabled = true;
          form.querySelector("button").disabled = true;
        } else {
          feedback.textContent =
            "Not quite. Think again, clever one.";
          feedback.className = "feedback bad";
          input.focus();
          input.select();
          if (navigator.vibrate) navigator.vibrate(30);
        }
      });
    </script>
  </body>
</html>
